import streamlit as st
import os

# --- 페이지 기본 설정 ---
st.set_page_config(page_title="종합 분석 보고서", page_icon="📝", layout="wide")

# --- 이미지 파일 경로 확인 함수 ---
def get_image_path(filename):
    path = os.path.join('report_images', filename)
    if not os.path.exists(path):
        st.warning(f"이미지 파일({path})을 찾을 수 없습니다. 분석 스크립트를 실행하여 이미지를 생성해주세요.")
        return None
    return path

# --- 보고서 본문 ---

st.title("📝 서울시 공공자전거 '따릉이' 데이터 분석 보고서")
st.markdown("**- 데이터 기반 운영 효율화 및 서비스 활성화 방안 -**")
st.markdown("---")

# --- 1. 개요 및 핵심 요약 ---
st.header("1. 개요 및 핵심 요약")
st.markdown(
    """
    본 보고서는 2020년부터 2025년까지의 서울시 공공자전거 '따릉이' 이용 데이터를 기반으로, 운영 효율성을 극대화하고 시민 만족도를 향상시키기 위한 데이터 기반 전략을 제시하는 것을 목표로 합니다.

    분석 결과, 따릉이 수요는 서울시 인구 감소 추세와는 무관하게 지속적으로 성장하며 **시민들의 필수 생활 교통수단으로 자리 잡았음**을 확인했습니다. 
    
    그러나 동시에 **소수의 인기 대여소에 수요가 집중**되고, 출퇴근 시간대를 중심으로 **고질적인 '자전거 쏠림 현상'**이 발생하여 운영 효율을 저해하는 핵심 요인임을 데이터를 통해 명확히 규명했습니다.

    이에 본 보고서는 **데이터 기반의 선제적 재배치, 이용 목적에 따른 거점 관리, 서비스 신뢰도 확보**를 핵심 전략으로 제언하며, 이를 통해 **'운영 효율성 증대 → 시민 만족도 향상 → 이용자 저변 확대 → 친환경 도시 교통 기여'**라는 선순환 구조 구축의 기회를 포착했습니다.
    """
)
st.markdown("---")

# --- 2. 주요 분석 결과 및 인사이트 ---
st.header("2. 주요 분석 결과 및 인사이트")

# --- 가. 거시적 이용 현황 ---
st.subheader("가. 거시적 이용 현황: 인구와 무관한 따릉이의 독자적 성장")
st.markdown(
    """
    서울시 인구는 지속적으로 감소했음에도 불구하고, 따릉이 이용 건수는 계속해서 증가했습니다. 이는 따릉이의 성장이 인구수보다는 **시민들의 라이프스타일 변화 및 단거리 이동 수요 증가**에 더 큰 영향을 받는다는 것을 시사하며, **필수 서비스로 진화**했음을 의미합니다.
    """
)
img_path = get_image_path('correlation_chart.png')
if img_path:
    st.image(img_path, caption="[그림 1] 서울시 인구는 지속 감소했으나, 따릉이 이용 증감률은 성장.")

# --- 나. 공간 분석: 수요 집중과 '쏠림 현상'의 명확화 ---
st.subheader("나. 공간 분석: 수요 집중과 '쏠림 현상'의 패턴 발견")
st.markdown(
    """
    소수의 인기 대여소가 전체 이용량에 유의미한 부분을 차지하며, 이들 지역을 중심으로 예측 가능한 '자전거 쏠림 현상'이 발생하고 있음을 확인했습니다. 이는 비효율적인 사후 대응이 아닌, **데이터 기반의 효율적인 사전 예측 재배치**가 가능함을 의미합니다.
    """
)
col1, col2 = st.columns(2)
with col1:
    img_path = get_image_path('pie_chart_top20_stations.png')
    if img_path:
        st.image(img_path, caption="[그림 2] 상위 20개 대여소가 전체 이용량의 상당 부분을 차지한다.")
with col2:
    img_path = get_image_path('map_station_netflow.png')
    if img_path:
        st.image(img_path, caption="[그림 3] 자전거 유출(🔴) 지역과 유입(🔵) 지역이 뚜렷하게 군집을 이룬다.")

# --- 다. 경로 분석: '교통'과 '레저'라는 두 가지 이용 목적 ---
st.subheader("다. 경로 분석: '교통'과 '레저'라는 두 가지 얼굴")
st.markdown(
    """
    전체 이용의 압도적인 다수가 **'편도'**로 나타나, 따릉이의 이용자 대부분의 **'단거리 교통수단'**으로서의 역할이 핵심임을 증명했습니다. 반면, '왕복' 이용은 청계천, 올림픽공원역, 서울숲, 월드컵 공원등 문화,관광 코스로 이용의 형태가 나뉘는것을 .
    """
)

st.markdown("---")

# --- 3. 종합 결론 및 제언 ---
st.header("3. 종합 결론 및 제언")

st.success(
    """
    **[제언 1] 운영 효율성 증대: '순이동량 예측 기반'의 선제적 재배치 시스템을 고도화해야 합니다.**

    *   **실행 방안:** 지도에서 확인된 '유출(🔴)/유입(🔵) 핵심 지역'을 재배치 트럭의 최우선 관리 구역으로 지정하고, 출퇴근 시간 전후로 집중적인 공급 및 수거를 수행하는 **동적 재배치 매뉴얼**을 수립합니다.
    """
)

st.success(
    """
    **[제언 2] 시민 만족도 향상: '이용 목적별 거점 관리'를 통해 서비스 신뢰도를 확보해야 합니다.**

    *   **실행 방안:** 주요 편도 경로의 시작/종료 대여소는 **'상시 이용 가능 대여소'**로 지정하여 출퇴근 시간대 가용성을 보장하고, 인기 왕복 경로의 레저 거점은 주말 수요에 대비한 **탄력적 운영**(임시 거치대 등)을 검토합니다.
    """
)

st.success(
    """
    **[제언 3] 지속 가능한 성장: 데이터 기반의 안정적 서비스를 통해 이용자 저변을 확대하고 친환경 교통에 기여해야 합니다.**

    *   **기대 효과:** "타고 싶을 때 항상 있고, 반납하기 편한" 따릉이는 그 자체로 가장 강력한 마케팅입니다. 안정적인 서비스는 더 많은 시민들이 단거리 이동 시 자가용 대신 따릉이를 선택하도록 유도하여, **'친환경 도시 교통'**이라는 최종 목표 달성에 기여할 것입니다.
    """
)